<!DOCTYPE html>
<html lang="en" style="width: 890px;">
    <head>
        <meta charset="utf-8"/>
        <title>stupid</title>
        <link rel="stylesheet" href="style.css">
        <script src="windows.js" type="text/javascript"></script>
        <link rel="stylesheet" href="https://unpkg.com/xp.css"/>
    </head>
<body style="background-image: url('new/window/bliss.png'); background-size: 100% 100%; background-attachment: fixed; background-repeat: no-repeat;" onload="startTime()">

    <header>

    </header>



    <main>

    <!--CREATE ARRAYS-->
    <script>
      var windows_array = [];
      var file_array = [];
      var tabs_array = [];
    </script>
  

    <!--DESKTOP FILES-->

    <!--HOME-->
    <div id="file_home" style="position: absolute; top: 32px; left: 32px;">
      <img id="file_home_img" src="new/files/pc.png" class="file" style="display: block; margin: auto;">
      <div id="file_home_name" class="file-name" style="top: -4px;">
        <p style="font-family: Tahoma; font-size: 12px; color: white; text-shadow: 1px 1px 2px #0a0a0a; text-align: center;">
          Welcome
        </p>
      </div>
    </div>
    <script>file_array.push([document.getElementById("file_home"), document.getElementById("file_home_name"), document.getElementById("file_home_img"), 0]);</script>

    <!--INFO-->
    <div id="file_info" style="position: absolute; top: 112px; left: 40px;">
      <img id="file_info_img" src="new/files/info2.png" class="file" style="display: block; margin: auto;">
      <div id="file_info_name" class="file-name" style="top: -4px;">
        <p style="font-family: Tahoma; font-size: 12px; color: white; text-shadow: 1px 1px 2px #0a0a0a; text-align: center;">
          Info
        </p>
      </div>
    </div>
    <script>file_array.push([document.getElementById("file_info"), document.getElementById("file_info_name"), document.getElementById("file_info_img"), 0]);</script>

    



    <!--WELCOME WINDOW-->
    <div class="window" id="window_welcome" style="user-select: none; position: absolute; top: 100px; width: 300px; height: 90px; display: none;">
      <div class="title-bar" id="window_welcome_header">
        <div class="title-bar-text" style="cursor:default;">
          Welcome!
        </div>

        <div class="title-bar-controls" id="window_welcome_header_controls" onmousedown="event.stopPropagation()">
          <button aria-label="Close" id="close_button" onclick="windowClose('window_welcome')"></button>
        </div>

      </div>
      <div class="window-body">
        <p>Hello, world!</p>
        <section class="field-row" style="justify-content: center">
          <button onclick="windowClose('window_welcome')">OK</button>
        </section>
      </div>
    </div>
    <script>dragElement(document.getElementById("window_welcome"));windows_array.push(document.getElementById("window_welcome"))</script>

    <!--TEST WINDOW-->
    <div class="window" id="window_test" style="user-select: none; position: absolute; top: 200px; width: 300px; height: 100px; display: none;">
      <div class="title-bar" id="window_test_header">
        <div class="title-bar-text" style="cursor:default;">
          Idk
        </div>

        <div class="title-bar-controls" id="window_test_header_controls" onmousedown="event.stopPropagation()">
          <button aria-label="Close" id="close_button" onclick="windowClose('window_test')"></button>
        </div>

      </div>
      <div class="window-body">
        <p>Lorem ipsum sraken pierdaken</p>
        <section class="field-row" style="justify-content: flex-end">
          <button>OK</button>
          <button>Cancel</button>
        </section>
      </div>
    </div>
    <script>dragElement(document.getElementById("window_test"));windows_array.push(document.getElementById("window_test"))</script>

    <!--CONSOLE WINDOW-->
    <div class="window" id="window_console" style="user-select: none; position: absolute; display: none;">
        <div class="title-bar" id="window_console_header">
            <div class="title-bar-text">Command Prompt</div>
            <div class="title-bar-controls" id="window_console_header_controls" onmousedown="event.stopPropagation()">
            <button aria-label="Close" id="close_button" onclick="windowClose('window_console')"></button>
            </div>
        </div>
        <div class="window-body">
            <pre>Microsoft&#10094;R&#10095; Windows DOS 
                &#10094;C&#10095; Copyright Microsoft Corp 1990-2001.
            <br>C:&#92;WINDOWS&#92;SYSTEM32> You can build a command line easily with a window and pre tag
            
            </pre>
        </div>
    </div>
    <script>dragElement(document.getElementById("window_console"));windows_array.push(document.getElementById("window_console"))</script>

    <!--PAINT WINDOW-->
    <div class="window" id="window_paint" style="user-select: none; position: absolute; display: none;">
        <div class="title-bar" id="window_paint_header">
            <div class="title-bar-text">untitled - Paint</div>
            <div class="title-bar-controls" id="window_paint_header_controls" onmousedown="event.stopPropagation()">
            <button aria-label="Close" id="close_button" onclick="windowClose('window_paint')"></button>
            </div>
        </div>
        <div class="window-body">
          <img src="img/additivecolor.png">
        </div>
    </div>
    <script>dragElement(document.getElementById("window_paint"));windows_array.push(document.getElementById("window_paint"))</script>

    <!--TASKBAR-->
    <div>
        <img id="taskbar" src="new/window/taskbar.png" style="user-select: none; position:fixed; width: 100%; height: 28px; left: 0px; bottom: 0;">
        <script>document.getElementById("taskbar").ondragstart = function(){return false;}</script>
        <!--CLOCK-->
        <p style="user-select: none; font-family: Tahoma; color: white; position:fixed; width: 100%; height: 28px; right: 20px; bottom: -19px; text-align: right; text-shadow: 1px 1px 2px #0a0a0a;" id="clock"></p>
        <!--START BUTTON-->
        <img src="new/window/startbutton_default.png" id="startbutton" style="user-select: none; position:fixed; height: 28px; left: 0px; bottom: 0;">
    </div>

    </main>



    <footer>

    </footer>


    <!--MAIN SCRIPTS-->
    <script>
        
        // Tabs controller
        const obj_taskbar = {
            arr: []
        };

        // Z index ordering _ready
        for(var i = 0; i <= windows_array.length - 1; i++) {
            setIndex(windows_array[i], 0);
        }

        // Start button
        var start_button = document.getElementById("startbutton");
        
        if (start_button) {
            start_button.ondragstart = function(){return false;}
            start_button.onmouseenter = function(){start_button.src = "new/window/startbutton_hover.png";}
            start_button.onmouseleave = function(){start_button.src = "new/window/startbutton_default.png";}
            start_button.onmouseup = function(){start_button.src = "new/window/startbutton_hover.png";}
            start_button.onmousedown = function(){start_button.src = "new/window/startbutton_click.png";}
        }

        
        // Open window
        function windowOpen(window_id) {
            var _window = document.getElementById(window_id);

            if (_window.style.display == "")
                return;

            _window.style.display = "";

            var pageWidth = window.screen.width;
            var pageHeight = document.documentElement.scrollHeight;

            var windowWidth = parseFloat(_window.style.width);
            var windowHeight = parseFloat(_window.style.height);

            var nextpos = 0;

            for (var i = 0; i < obj_taskbar.arr.length; i++) {
                //nextpos = i;
            }

            _window.style.left = (pageWidth / 2) - (windowWidth / 2) + (nextpos * 64) + "px";
            _window.style.top = (pageHeight / 2) - (windowHeight / 2) + (nextpos * 64) + "px";
        }

        // Close window
        function windowClose(window_id) {
            var _window = document.getElementById(window_id);
            _window.style.display = "none";
            tabClose(window_id);
        }

        // Set window z index
        function setIndex(item, index) {
            item.style.zIndex = index;
        }

        // Window focus
        function windowFocus(window) {

            for(var i = 0; i <= windows_array.length - 1; i++) {
                windows_array[i].style.zIndex = 0;
            }
            if (window) window.style.zIndex += 1;

            for(let i = 0; i <= obj_taskbar.arr.length - 1; i++) {

                if (obj_taskbar.arr[i][1] == window.id) {

                    for (let j = 0; j <= obj_taskbar.arr.length - 1; j++) {

                        obj_taskbar.arr[j][3] = 0;

                    }

                    obj_taskbar.arr[i][3] = 2;

                }

            }

        }

        // Select file
        function fileFocus(file, img) {

            for(var i = 0; i <= file_array.length - 1; i++) {
                file_array[i][1].style.backgroundColor = "#00000000";
                file_array[i][2].style.opacity = "100%";
                file_array[i][3] = 0;

            }
            if (file){
                file.style.backgroundColor = "#0004ff";
                img.style.opacity = "70%";
            }
        }

        // Click file
        function fileClick(file) {

            switch(file.id) {
                case "file_home":
                    tabOpen("tab_welcome", "Welcome", "new/files/pc.png", "window_welcome");
                    windowOpen("window_welcome");
                break;
                case "file_info":
                    tabOpen("tab_test", "Test", "new/files/info2.png", "window_test");
                    windowOpen("window_test");
                break;
            }
        }
          
        // Unclick
        window.onclick = function(){fileFocus(null);}
        

        /*
        create_tab("tab_welcome")
    <div id="tab_welcome">
      <img id="tab_welcome_tab" src="new/window/tab_default.png" style="user-select: none; position: fixed; left: 96px; bottom: 1px;">

      <img src="new/files/pc.png" class="file" style="user-select: none; position: fixed; left: 104px; bottom: 6px; width: 16px; height: 16px;">
      <p style="user-select: none; font-family: Tahoma; color: white; position:fixed; width: 100%; height: 28px; left: 128px; bottom: -19px; text-shadow: 1px 1px 1px #0a0a0aaa;">Welcome</p>
    </div>
        function Tab(x, y, name, sprite, action){
            this.x = x;
            this.y = y;
            this.name = name;
            this.sprite = sprite;
            this.action = action;
        }
      */
        function tabOpen(id, name, sprite, window_id) {


            var _window = document.getElementById(window_id);
            if (_window.style.display == "")
                return;

            let tab = document.createElement("div");
            let tab_sprite = document.createElement("img");
            let tab_icon = document.createElement("img");
            let tab_text = document.createElement("p");

            //let obj_tab = new Tab(0, 0, name, sprite, 0);

            tab.id = id;
            tab.style.userSelect = "none";
            tab.style.position = "fixed";
            tab.style.left = "96px";
            tab.style.bottom = "1px";

            tab_sprite.id = id + "_sprite";
            tab_sprite.src = "new/window/tab_default.png";
            tab_sprite.style.userSelect = "none";
            tab_sprite.style.position = "absolute";
            tab_sprite.style.left = "0px";
            tab_sprite.style.bottom = "0px";

            tab_icon.id = id + "_icon";
            tab_icon.src = sprite;
            tab_icon.style.userSelect = "none";
            tab_icon.style.position = "absolute";
            tab_icon.style.left = "8px";
            tab_icon.style.bottom = "4px";
            tab_icon.style.width = "16px";
            tab_icon.style.height = "16px";

            tab_text.id = id + "_text";
            tab_text.style.userSelect = "none";
            tab_text.style.fontFamily = "Tahoma";
            tab_text.style.color = "white";
            tab_text.style.textShadow = "1px 1px 1px #0a0a0aaa";
            tab_text.style.position = "absolute";
            tab_text.style.left = "32px";
            tab_text.style.bottom = "-6px";
            tab_text.textContent = name;


            obj_taskbar.arr.push([tab, window_id, tab_sprite, 0]);
            document.body.appendChild(tab).appendChild(tab_sprite);
            tab.appendChild(tab_icon);
            tab.appendChild(tab_text);
        }

        function tabClose(window_id) {

            for (let i = 0; i < obj_taskbar.arr.length; i++) {

                if (obj_taskbar.arr[i][1] == window_id) {

                    let tab = obj_taskbar.arr[i][0];
                    if (tab) {
                        document.body.removeChild(tab);
                    }
                    obj_taskbar.arr.splice(i, 1);
                    break;

                }

            }
            
        }

        // Create start windows and tabs

        tabOpen("tab_welcome", "Welcome", "new/files/pc.png", "window_welcome");
        windowOpen("window_welcome");

        tabOpen("tab_info", "Info", "new/files/info2.png", "window_test");
        windowOpen("window_test");

        tabOpen("tab_welcome", "Terminal", "new/files/terminal.png", "window_console");
        windowOpen("window_console");

        tabOpen("tab_paint", "Paint", "new/files/paint.png", "window_paint");
        windowOpen("window_paint");

        // Main loop
        var loop = function() {

            // Z index ordering _loop
            for(let i = 0; i <= windows_array.length - 1; i++) {
                if (windows_array[i]) {
                    
                    windows_array[i].onmousedown = function() {
                        windowFocus(windows_array[i]);
                    }
                }
            }

            // File select behavior
            for (let i = 0; i <= file_array.length - 1; i++) {
                if (file_array[i]) {
                    file_array[i][0].onclick = function() {
                        event.stopPropagation();

                        if (file_array[i][3] == 0) {
                          fileFocus(file_array[i][1], file_array[i][2]);
                          file_array[i][3] = 1;
                        } else {
                          // File click behavior
                          fileClick(file_array[i][0]);
                        }

                    }
                }
            }

          // Taskbar tabs
          for(var i = 0; i <= obj_taskbar.arr.length - 1; i++) {

              if (obj_taskbar.arr[i][0]) {
                  obj_taskbar.arr[i][0].style.left = 96 + (150 * i) + "px";
              }

          }

          for(let i = 0; i <= obj_taskbar.arr.length - 1; i++) {

            /*
              if (obj_taskbar.arr[i][0]) {
                  obj_taskbar.arr[i][0].ondragstart = function(){return false;}
                  obj_taskbar.arr[i][0].onmouseenter = function(){obj_taskbar.arr[i][2].src = "new/window/tab_hover.png"; console.log("a")}
                  obj_taskbar.arr[i][0].onmouseleave = function(){obj_taskbar.arr[i][2].src = "new/window/tab_default.png";}
                  obj_taskbar.arr[i][0].onmouseup = function(){obj_taskbar.arr[i][2].src = "new/window/tab_hover.png";}
                  obj_taskbar.arr[i][0].onmousedown = function(){obj_taskbar.arr[i][2].src = "new/window/tab_click.png";}
                  obj_taskbar.arr[i][0].onclick = function(){obj_taskbar.arr[i][2].src = "new/window/tab_click.png";windowFocus(document.getElementById(obj_taskbar.arr[i][1]));}
              }
            */

            if (obj_taskbar.arr[i]) {
                
                obj_taskbar.arr[i][0].onclick = function() {

                    windowFocus(document.getElementById(obj_taskbar.arr[i][1]));
                    for(let j = 0; j <= obj_taskbar.arr.length - 1; j++) {

                        obj_taskbar.arr[j][3] = 0;

                    }
                    obj_taskbar.arr[i][3] = 3;
                }

                

                obj_taskbar.arr[i][0].onmouseenter = function() {

                    if (obj_taskbar.arr[i][3] == 0) obj_taskbar.arr[i][3] = 1;
                    if (obj_taskbar.arr[i][3] == 2) obj_taskbar.arr[i][3] = 3;

                }

                obj_taskbar.arr[i][0].onmouseleave = function() {

                    if (obj_taskbar.arr[i][3] == 1) obj_taskbar.arr[i][3] = 0;
                    if (obj_taskbar.arr[i][3] == 3) obj_taskbar.arr[i][3] = 2;

                }
                
                switch(obj_taskbar.arr[i][3]) {

                    case 0:
                        obj_taskbar.arr[i][2].src = "new/window/tab_default.png";
                    break;
                    case 1:
                        obj_taskbar.arr[i][2].src = "new/window/tab_hover.png";
                    break;
                    case 2:
                        obj_taskbar.arr[i][2].src = "new/window/tab_click.png";
                    break;
                    case 3:
                        obj_taskbar.arr[i][2].src = "new/window/tab_click_hover.png";
                    break;

                }

            }

          }

            window.requestAnimationFrame(loop);

        }

        loop();

    </script>

    <!--CLOCK BEHAVIOR-->
    <script>
        function startTime() {
                const today = new Date();
                let h = today.getHours();
                let m = today.getMinutes();
                h = checkTime(h);
                m = checkTime(m);
                document.getElementById('clock').innerHTML =  h + ":" + m;
                setTimeout(startTime, 1000);
            }

            function checkTime(i) {
                if (i < 10) {i = "0" + i};
                    return i;
            }
    </script>
</body>
</html>